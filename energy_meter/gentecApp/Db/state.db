#! Generated by VisualDCT v2.6
#! DBDSTART
#! DBDEND


# 0 - OK
# 1 - ERROR
record(calc, "$(DEVICE):STATE") {
  field(SCAN, ".1 second")
  field(CALC, "!a")
  field(INPA, "$(DEVICE):ConnectionState")
}

record(stringin, "$(DEVICE):ConnectionMonitor") {
  field(DTYP, "stream")
  field(INP, "@gnt.proto probeConnection($(CHANNEL)) $(port)")
}

# 0 - Disconnected
# 1 - Connected
# 2 - Timeout
record(aSub, "$(DEVICE):ConnectionAnalyser") {
  field(SNAM, "connection_status")
  field(INPA, "$(DEVICE):ConnectionMonitor.SEVR PP")
  field(INPB, "$(DEVICE):ConnectionMonitor.STAT PP")
  field(FTA, "STRING")
  field(FTB, "STRING")
}

record(bi, "$(DEVICE):ConnectionState") {
  field(ZSV, "MAJOR")
  field(ZNAM, "Disconnected")
  field(ONAM, "Connected")
}

record(calcout, "$(DEVICE):ConnectionCounter") { 
  field(DESC, "Checks for no. of timeouts less than C") 
  field(CALC, "(a == 0) ? ((b == 0) ? 0 : b - 1) : c") 
  field(INPA, "$(DEVICE):ConnectionAnalyser.VAL PP") 
  field(INPB, "$(DEVICE):ConnectionCounter.VAL") 
  field(INPC, "3") 
} 
  
record(calcout, "$(DEVICE):ConnectionStateCalc") { 
  field(SCAN, "2 second") 
  field(CALC, "a != 0") 
  field(INPA, "$(DEVICE):ConnectionCounter PP") 
  field(OUT, "$(DEVICE):ConnectionState PP") 
  field(PINI, "YES")
}

#! Further lines contain data used by VisualDCT
#! View(1826,2152,1.0)
#! Record("$(DEVICE):STATE",3180,2302,0,1,"$(DEVICE):STATE")
#! Field("$(DEVICE):STATE.INPA",16777215,0,"$(DEVICE):STATE.INPA")
#! Link("$(DEVICE):STATE.INPA","$(DEVICE):ConnectionState.VAL")
#! Record("$(DEVICE):ConnectionMonitor",1880,2216,0,1,"$(DEVICE):ConnectionMonitor")
#! Field("$(DEVICE):ConnectionMonitor.SEVR",16777215,1,"$(DEVICE):ConnectionMonitor.SEVR")
#! Field("$(DEVICE):ConnectionMonitor.STAT",16777215,1,"$(DEVICE):ConnectionMonitor.STAT")
#! Record("$(DEVICE):ConnectionAnalyser",2180,2174,0,1,"$(DEVICE):ConnectionAnalyser")
#! Field("$(DEVICE):ConnectionAnalyser.INPA",16777215,0,"$(DEVICE):ConnectionAnalyser.INPA")
#! Link("$(DEVICE):ConnectionAnalyser.INPA","$(DEVICE):ConnectionMonitor.SEVR")
#! Field("$(DEVICE):ConnectionAnalyser.INPB",16777215,0,"$(DEVICE):ConnectionAnalyser.INPB")
#! Link("$(DEVICE):ConnectionAnalyser.INPB","$(DEVICE):ConnectionMonitor.STAT")
#! Field("$(DEVICE):ConnectionAnalyser.VAL",16777215,0,"$(DEVICE):ConnectionAnalyser.VAL")
#! Record("$(DEVICE):ConnectionState",2940,2302,0,1,"$(DEVICE):ConnectionState")
#! Field("$(DEVICE):ConnectionState.VAL",16777215,1,"$(DEVICE):ConnectionState.VAL")
#! Record("$(DEVICE):ConnectionCounter",2420,2234,0,1,"$(DEVICE):ConnectionCounter")
#! Field("$(DEVICE):ConnectionCounter.INPA",16777215,0,"$(DEVICE):ConnectionCounter.INPA")
#! Link("$(DEVICE):ConnectionCounter.INPA","$(DEVICE):ConnectionAnalyser.VAL")
#! Field("$(DEVICE):ConnectionCounter.VAL",16777215,0,"$(DEVICE):ConnectionCounter.VAL")
#! Field("$(DEVICE):ConnectionCounter.INPB",16777215,0,"$(DEVICE):ConnectionCounter.INPB")
#! Link("$(DEVICE):ConnectionCounter.INPB","$(DEVICE):ConnectionCounter.VAL")
#! Record("$(DEVICE):ConnectionStateCalc",2680,2254,0,1,"$(DEVICE):ConnectionStateCalc")
#! Field("$(DEVICE):ConnectionStateCalc.INPA",16777215,0,"$(DEVICE):ConnectionStateCalc.INPA")
#! Link("$(DEVICE):ConnectionStateCalc.INPA","$(DEVICE):ConnectionCounter.VAL")
#! Field("$(DEVICE):ConnectionStateCalc.OUT",16777215,1,"$(DEVICE):ConnectionStateCalc.OUT")
#! Link("$(DEVICE):ConnectionStateCalc.OUT","$(DEVICE):ConnectionState.VAL")
